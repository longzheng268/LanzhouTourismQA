-- ============================================
-- 兰州旅游知识问答系统 - 数据库初始化脚本
-- 语法严格版 - 避免重复创建表
-- ============================================

-- 设置严格模式
SET SQL_MODE = 'STRICT_ALL_TABLES';
SET NAMES utf8mb4;
SET CHARACTER SET utf8mb4;

-- 创建数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS qa_database
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_unicode_ci;

-- 切换到数据库
USE qa_database;

-- 检查并创建 qa_pairs 表（知识库）
CREATE TABLE IF NOT EXISTS qa_pairs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    question VARCHAR(500) NOT NULL,
    answer TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_question (question(255)),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 检查并创建 chat_history 表（聊天历史）
CREATE TABLE IF NOT EXISTS chat_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_timestamp (timestamp)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 插入兰州旅游知识数据（使用 INSERT IGNORE 避免重复）
INSERT IGNORE INTO qa_pairs (question, answer) VALUES
('兰州在哪里？', '兰州是甘肃省省会，位于中国西北部，黄河上游。地理坐标为东经103°30\'，北纬36°03\'，是丝绸之路重镇。'),
('兰州有什么著名景点？', '兰州著名景点包括：1) 白塔山公园 - 黄河岸边的标志性景点；2) 兰山公园 - 俯瞰兰州全景；3) 五泉山公园 - 因五眼泉水得名；4) 黄河铁桥（中山桥）- 百年历史；5) 水车博览园 - 展示古代灌溉技术；6) 甘肃省博物馆 - 藏有丰富文物。'),
('兰州牛肉面有什么特点？', '兰州牛肉面讲究"一清二白三红四绿五黄"：汤清（一清）、萝卜白（二白）、辣椒油红（三红）、香菜蒜苗绿（四绿）、面条黄亮（五黄）。面条有多种粗细可选：毛细、细、二细、韭叶、宽面等。'),
('兰州的最佳旅游时间是什么时候？', '兰州最佳旅游时间是5-10月。夏季（6-8月）气候凉爽，是避暑胜地；秋季（9-10月）天高气爽，瓜果飘香。春季多风沙，冬季寒冷干燥。'),
('如何到达兰州？', '1) 飞机：兰州中川国际机场，有国内外航线；2) 高铁：兰州西站、兰州站，连接全国高铁网；3) 普通火车：兰州站；4) 自驾：连霍高速、京藏高速等多条高速交汇。'),
('兰州有哪些特色美食？', '兰州特色美食：1) 兰州牛肉面（必吃）；2) 手抓羊肉；3) 灰豆子（甜品）；4) 酿皮子；5) 热冬果；6) 牛奶鸡蛋醪糟；7) 烤羊肉串；8) 浆水面。'),
('兰州黄河铁桥的历史？', '黄河铁桥（中山桥）建于1909年，是黄河上第一座铁桥，由德国商人承建。桥长234米，宽7.5米。初名"黄河铁桥"，1942年为纪念孙中山先生改名"中山桥"。是全国重点文物保护单位。'),
('兰州白塔山有什么传说？', '白塔山因山顶有白塔寺而得名。相传元代忽必烈为纪念西藏喇嘛而建。白塔七级八面，高约17米。传说登上白塔可俯瞰兰州全景，眺望黄河九曲。'),
('兰州的气候特点是什么？', '兰州属于温带大陆性气候，特点：1) 冬季寒冷干燥，夏季凉爽；2) 昼夜温差大；3) 降水少，蒸发强；4) 日照充足；5) 多风沙。年均气温10℃左右，7月最热，1月最冷。'),
('兰州有什么特产可以带回家？', '兰州特产：1) 兰州百合（甜百合）；2) 苦水玫瑰；3) 白兰瓜；4) 黑瓜子；5) 三炮台茶；6) 牛肉面调料包；7) 甘草杏；8) 软儿梨。'),
('兰州周边有什么值得一去的地方？', '兰州周边景点：1) 兴隆山（国家级森林公园）；2) 吐鲁沟森林公园；3) 什川古梨园；4) 青城古镇；5) 河口古镇；6) 临夏（民族风情）；7) 夏河拉卜楞寺（藏传佛教）。'),
('兰州的住宿推荐？', '兰州住宿推荐：1) 城关区（市中心，交通便利）；2) 七里河区（靠近西站）；3) 安宁区（高校区，安静）。高档：兰州饭店、宁卧庄宾馆；中档：如家、汉庭等连锁；经济型：青年旅舍。'),
('兰州的夜市在哪里？', '兰州主要夜市：1) 正宁路小吃夜市（最著名）；2) 南关民族风味一条街；3) 农民巷夜市；4) 西关十字夜市。推荐：烤羊肉串、牛奶鸡蛋醪糟、酿皮子、灰豆子。'),
('兰州的市花是什么？', '兰州市花是玫瑰花。兰州苦水玫瑰闻名全国，种植历史悠久，花大瓣厚，香味浓郁，是制作玫瑰油、玫瑰茶、玫瑰糕点的优质原料。'),
('兰州有什么节庆活动？', '兰州主要节庆：1) 兰州国际马拉松（6月）；2) 兰州桃花节（4-5月）；3) 苦水玫瑰节（5月）；4) 黄河文化旅游节；5) 兰州水车节。这些活动展现了兰州的自然和人文魅力。'),
('兰州牛肉面的历史有多久？', '兰州牛肉面起源于清代嘉庆年间，由国子监太学生陈维精将制作技艺传入兰州。后经马保子等人改良创新，形成了现代兰州牛肉面的雏形，至今已有200多年历史。'),
('兰州的海拔是多少？', '兰州平均海拔约1520米。市区海拔在1400-1600米之间，地势由西南向东北倾斜。相比东部平原地区，海拔较高，但高原反应不明显。'),
('兰州话有什么特点？', '兰州方言属于北方方言区，特点：1) 声调较少，只有3-4个；2) 保留入声字；3) 词汇独特，如"莎莎"（美女）、"满福"（很好）；4) 语速快，有节奏感；5) 与普通话差异较大但可听懂。'),
('兰州的市树是什么？', '兰州市树是国槐。国槐在兰州种植广泛，适应性强，寿命长，夏季开花，是兰州城市绿化的重要树种，象征着兰州人民坚韧不拔的精神。'),
('兰州有什么文化古迹？', '兰州文化古迹：1) 白塔寺（元代）；2) 五泉山古建筑群；3) 金天观；4) 兰州城隍庙；5) 鲁土司衙门；6) 青城古民居；7) 河口古镇。这些古迹见证了兰州的历史变迁。'),
('兰州的特产水果有哪些？', '兰州特产水果：1) 白兰瓜（黄河蜜瓜）- 甜脆多汁；2) 软儿梨 - 冬季特色；3) 兰州百合 - 甜百合，可生吃；4) 杏子 - 什川杏园；5) 桃子 - 秦王桃。夏季瓜果飘香。'),
('兰州的黄河文化有什么特色？', '兰州黄河文化特色：1) 水车文化 - 古代灌溉智慧；2) 羊皮筏子 - 传统渡河工具；3) 黄河铁桥 - 百年历史；4) 黄河母亲雕塑 - 城市标志；5) 黄河风情线 - 百里黄河景观带。'),
('兰州的旅游线路怎么安排？', '兰州2日游推荐：Day1：黄河铁桥→白塔山公园→水车博览园→黄河母亲雕塑→正宁路夜市；Day2：五泉山公园→兰山公园→甘肃省博物馆→兰州老街。周边可去兴隆山或吐鲁沟。'),
('兰州的物价水平如何？', '兰州物价水平中等偏低：1) 牛肉面8-15元；2) 住宿200-400元/晚；3) 公交1-2元；4) 景点门票大多免费或20-50元；5) 特产价格实惠。整体消费比一线城市低30-50%。'),
('兰州有什么非物质文化遗产？', '兰州非物质文化遗产：1) 兰州牛肉面制作技艺；2) 苦水玫瑰种植加工技艺；3) 兰州刻葫芦；4) 河州平弦；5) 永登高高跷；6) 青城小调。这些非遗展现了兰州独特的文化魅力。');

-- 验证数据插入
SELECT '数据库初始化完成' AS status;
SELECT COUNT(*) AS qa_pairs_count FROM qa_pairs;
SELECT COUNT(*) AS chat_history_count FROM chat_history;

-- 显示表结构信息
SHOW TABLES;

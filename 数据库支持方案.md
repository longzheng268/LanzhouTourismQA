# æ•°æ®åº“æ”¯æŒæ–¹æ¡ˆ

## ğŸ“‹ å½“å‰çŠ¶æ€

**å½“å‰Kotlinç‰ˆæœ¬**ï¼šâŒ ä¸åŒ…å«æ•°æ®åº“é©±åŠ¨
**C++ç‰ˆæœ¬**ï¼šâœ… ä½¿ç”¨MariaDBæ•°æ®åº“

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ·»åŠ æ•°æ®åº“æ”¯æŒï¼ˆæ¨èï¼‰

å¦‚æœéœ€è¦å…¼å®¹C++ç‰ˆæœ¬çš„æ•°æ®åº“é…ç½®ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

#### 1. ä¿®æ”¹ build.gradle.kts

æ·»åŠ MariaDB JDBCé©±åŠ¨ï¼š
```kotlin
dependencies {
    // ... ç°æœ‰ä¾èµ– ...

    // MariaDB JDBCé©±åŠ¨
    implementation("org.mariadb.jdbc:mariadb-java-client:3.3.2")

    // æ•°æ®åº“è¿æ¥æ± ï¼ˆå¯é€‰ï¼Œæé«˜æ€§èƒ½ï¼‰
    implementation("com.zaxxer:HikariCP:5.1.0")
}
```

#### 2. åˆ›å»ºæ•°æ®åº“è¿æ¥ç®¡ç†å™¨

åˆ›å»ºæ–‡ä»¶ï¼š`src/main/kotlin/com/lanzhou/qa/database/DatabaseManager.kt`

```kotlin
package com.lanzhou.qa.database

import com.zaxxer.hikari.HikariConfig
import com.zaxxer.hikari.HikariDataSource
import java.sql.Connection

class DatabaseManager(
    private val host: String = "raspberry.lz-0315.com",
    private val port: Int = 3306,
    private val database: String = "qa_database",
    private val username: String = "root",
    private val password: String = "lz"
) {
    private var dataSource: HikariDataSource? = null

    init {
        initializeConnection()
    }

    private fun initializeConnection() {
        val config = HikariConfig().apply {
            jdbcUrl = "jdbc:mariadb://$host:$port/$database?useSSL=false"
            this.username = this@DatabaseManager.username
            this.password = this@DatabaseManager.password
            driverClassName = "org.mariadb.jdbc.Driver"

            // è¿æ¥æ± é…ç½®
            maximumPoolSize = 10
            minimumIdle = 2
            connectionTimeout = 30000
            idleTimeout = 600000
            maxLifetime = 1800000
        }

        dataSource = HikariDataSource(config)
    }

    fun getConnection(): Connection? {
        return try {
            dataSource?.connection
        } catch (e: Exception) {
            e.printStackTrace()
            null
        }
    }

    fun close() {
        dataSource?.close()
    }

    // æµ‹è¯•è¿æ¥
    fun testConnection(): Boolean {
        return try {
            getConnection()?.use { true } ?: false
        } catch (e: Exception) {
            false
        }
    }

    // æŸ¥è¯¢æ‰€æœ‰é—®ç­”å¯¹
    fun getAllQAPairs(): List<QAPair> {
        val qaPairs = mutableListOf<QAPair>()
        val sql = "SELECT id, question, answer FROM qa_pairs ORDER BY id"

        getConnection()?.use { conn ->
            conn.createStatement().use { stmt ->
                stmt.executeQuery(sql).use { rs ->
                    while (rs.next()) {
                        qaPairs.add(
                            QAPair(
                                id = rs.getInt("id"),
                                question = rs.getString("question"),
                                answer = rs.getString("answer")
                            )
                        )
                    }
                }
            }
        }

        return qaPairs
    }

    // ä¿å­˜èŠå¤©å†å²
    fun saveChatHistory(question: String, answer: String) {
        val sql = "INSERT INTO chat_history (question, answer) VALUES (?, ?)"

        getConnection()?.use { conn ->
            conn.prepareStatement(sql).use { pstmt ->
                pstmt.setString(1, question)
                pstmt.setString(2, answer)
                pstmt.executeUpdate()
            }
        }
    }
}

data class QAPair(
    val id: Int,
    val question: String,
    val answer: String
)
```

#### 3. åˆ›å»ºæ•°æ®åº“é…ç½®ç®¡ç†å™¨

åˆ›å»ºæ–‡ä»¶ï¼š`src/main/kotlin/com/lanzhou/qa/config/DatabaseConfig.kt`

```kotlin
package com.lanzhou.qa.config

import kotlinx.serialization.Serializable

@Serializable
data class DatabaseConfig(
    val enabled: Boolean = false,
    val host: String = "raspberry.lz-0315.com",
    val port: Int = 3306,
    val database: String = "qa_database",
    val username: String = "root",
    val password: String = "lz"
)
```

#### 4. ä¿®æ”¹ ConfigManager.kt

æ·»åŠ æ•°æ®åº“é…ç½®åŠ è½½ï¼š
```kotlin
// åœ¨ ConfigManager.kt ä¸­æ·»åŠ 
fun loadDatabaseConfig(): DatabaseConfig {
    return try {
        val jsonString = File("src/main/resources/config.json").readText()
        val config = Json.decodeFromString<Config>(jsonString)
        config.database ?: DatabaseConfig()
    } catch (e: Exception) {
        DatabaseConfig() // ä½¿ç”¨é»˜è®¤é…ç½®
    }
}
```

#### 5. ä¿®æ”¹ QAService.kt

æ”¯æŒæ•°æ®åº“å’ŒJSONåŒæ¨¡å¼ï¼š
```kotlin
class QAService {
    private val config = ConfigManager.loadConfig()
    private val databaseConfig = ConfigManager.loadDatabaseConfig()

    // çŸ¥è¯†åº“æ¥æº
    private val knowledgeItems = if (databaseConfig.enabled) {
        // ä½¿ç”¨æ•°æ®åº“
        val dbManager = DatabaseManager(
            host = databaseConfig.host,
            port = databaseConfig.port,
            database = databaseConfig.database,
            username = databaseConfig.username,
            password = databaseConfig.password
        )
        dbManager.getAllQAPairs().map {
            KnowledgeItem(it.id, it.question, it.answer, "æ•°æ®åº“")
        }
    } else {
        // ä½¿ç”¨JSON
        ConfigManager.loadKnowledgeBase().knowledge_base
    }

    // ... å…¶ä½™ä»£ç ä¿æŒä¸å˜ ...
}
```

#### 6. æ›´æ–° config.json

æ·»åŠ æ•°æ®åº“é…ç½®éƒ¨åˆ†ï¼š
```json
{
  "api": {
    "api_key": "æ‚¨çš„APIå¯†é’¥",
    "api_url": "https://api.mimo.com/v1/chat/completions",
    "model": "mimo-v2-flash",
    "temperature": 0.7,
    "max_tokens": 1000
  },
  "system": {
    "prompt_template": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å…°å·æ—…æ¸¸ä¸“å®¶...",
    "top_k": 5
  },
  "embedding": {
    "model": "local",
    "dimension": 384
  },
  "database": {
    "enabled": false,
    "host": "raspberry.lz-0315.com",
    "port": 3306,
    "database": "qa_database",
    "username": "root",
    "password": "lz"
  }
}
```

### æ–¹æ¡ˆ2ï¼šä¿æŒJSONæ–¹æ¡ˆï¼ˆå½“å‰ï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… å·²å®Œæˆï¼Œæ— éœ€ä¿®æ”¹
- âœ… æ— éœ€æ•°æ®åº“æœåŠ¡å™¨
- âœ… å¯åŠ¨æ›´å¿«
- âœ… éƒ¨ç½²æ›´ç®€å•

**æ•°æ®åº“è„šæœ¬ä½ç½®**ï¼š
```
D:\Code_Project\Cpp Project\LLM_ContinuingEducation_QA\setup_database_fixed.sql
```

## ğŸ“Š å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | å½“å‰JSONæ–¹æ¡ˆ | æ•°æ®åº“æ–¹æ¡ˆ |
|------|--------------|------------|
| å…¼å®¹æ€§ | âœ… å·²å®Œæˆ | âš ï¸ éœ€è¦æ·»åŠ  |
| å¤æ‚åº¦ | â­ ç®€å• | â­â­â­ ä¸­ç­‰ |
| ä¾èµ– | æ—  | MariaDBæœåŠ¡å™¨ |
| å¯åŠ¨é€Ÿåº¦ | â­â­â­â­â­ å¿« | â­â­ éœ€è¦è¿æ¥ |
| éƒ¨ç½² | â­â­â­â­â­ æç®€å• | â­â­ éœ€è¦é…ç½® |

## ğŸ’¡ å»ºè®®

### å¦‚æœæ‚¨éœ€è¦æ•°æ®åº“æ”¯æŒ
è¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥ç«‹å³ä¸ºæ‚¨å®ç°å®Œæ•´çš„æ•°æ®åº“æ”¯æŒæ–¹æ¡ˆã€‚

### å¦‚æœæ‚¨å¯ä»¥ä½¿ç”¨JSON
å½“å‰æ–¹æ¡ˆå·²ç»å®Œç¾æ»¡è¶³éœ€æ±‚ï¼Œæ— éœ€ä¿®æ”¹ã€‚

## ğŸ¯ æˆ‘çš„æ¨è

**ä¿æŒå½“å‰JSONæ–¹æ¡ˆ**ï¼ŒåŸå› ï¼š
1. 25æ¡çŸ¥è¯†ç”¨JSONå®Œå…¨å¤Ÿç”¨
2. æ— éœ€é¢å¤–ä¾èµ–å’Œé…ç½®
3. å¯åŠ¨æ›´å¿«ï¼Œéƒ¨ç½²æ›´ç®€å•
4. ä¸C++ç‰ˆæœ¬åŠŸèƒ½ç›¸åŒï¼Œåªæ˜¯å­˜å‚¨æ–¹å¼ä¼˜åŒ–

**å¦‚æœç¡®å®éœ€è¦æ•°æ®åº“**ï¼Œæˆ‘å¯ä»¥10åˆ†é’Ÿå†…ä¸ºæ‚¨æ·»åŠ å®Œæ•´æ”¯æŒã€‚

---

**å½“å‰çŠ¶æ€**ï¼šâœ… JSONæ–¹æ¡ˆå·²å°±ç»ª
**æ•°æ®åº“æ”¯æŒ**ï¼šå¯é€‰ï¼Œéœ€è¦æ—¶å¯æ·»åŠ 
**C++å…¼å®¹æ€§**ï¼šåŠŸèƒ½ç›¸åŒï¼Œå­˜å‚¨æ–¹å¼ä¼˜åŒ–
